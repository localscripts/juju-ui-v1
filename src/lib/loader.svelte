<script>
  let { ondone = () => {} } = $props();
  let phase = $state('drawing');

  function drawn() {
    phase = 'filling';
    setTimeout(() => {
      phase = 'sliding';
      setTimeout(() => {
        phase = 'out';
        setTimeout(() => { phase = 'done'; ondone(); }, 900);
      }, 2800);
    }, 700);
  }
</script>

{#if phase !== 'done'}
  <div data-tauri-drag-region  class="select-none  overlay" class:out={phase === 'out'}>
    <div data-tauri-drag-region  class="pointer-events-none logo ">

      <!-- standalone J: draws, fills, stays -->
      <svg class="j" viewBox="0 0 679.78 1044.87" xmlns="http://www.w3.org/2000/svg">
        <path
          class="sp" class:filled={phase !== 'drawing'}
          style="--len:900; --dur:0.7s; --delay:0s"
          stroke="#fff" stroke-width="9" stroke-linecap="round" stroke-linejoin="round"
          d="M679.62,68.62S683.08,38,657.18,24.84C619.11,5.51,589,62.08,589,62.08s7.58-33.63-15.4-51.41-43.17-8-43.17-8-31.56,14.69-28.13,60.68c1.81,24.29,31.53,76.92,48.51,110.75,38.89-40.34,63-40.17,84.87-51.76C676.4,100.8,679.62,68.62,679.62,68.62Z"
        />
        <path
          class="sp" class:filled={phase !== 'drawing'}
          style="--len:3400; --dur:2.5s; --delay:0.05s"
          stroke="#fff" stroke-width="9" stroke-linecap="round" stroke-linejoin="round"
          d="M450.56,634.09s105.67-38.8,172.23-85.19c12.3,0,19,8.52,13.4,21.77-3.89,9.47-16.49,19.88-38.41,34.07-40.61,26.51-107.22,59.64-168.85,87.08l-4.29,11.36c-83.17,219.59-196.92,341.69-337,341.69-64.37,0-97.44-40.69-85.08-99.38,11.76-55.84,55.66-107,110.41-146.71,55.9-40.71,111.1-69.09,195.75-107L445.46,330.26a341.43,341.43,0,0,0,14.65-46.5c5.71-25.07,27.7-43.29,53.41-43.42h1.05c72.88,0,75.62,27.45,50.3,93.71ZM285.75,751.46c-69.25,32.18-117.63,59.62-151.81,87.07-44.49,36-70.2,68.15-77.18,101.28C51.58,964.41,62,982.4,91.33,982.4C158.54,982.4,226.4,902.9,285.75,751.46Z"
          onanimationend={drawn}
        />
      </svg>

      <!--
        Wordmark clip: same 140px height as standalone J.
        At 140px tall → wordmark renders 495px wide (1841.43/520.1 * 140).
        Letter positions at 495px scale:
          heart1 (x=274): 274/1841.43 * 495 = 74px  ← must be hidden
          first j body ends ~x=580: 580/1841.43 * 495 = 156px
          second u starts after that
        Clip at 160px to fully clear the first j + its heart.
        Visible = 495 - 160 = 335px = "uju.you"
        margin-left: -160px on the SVG to shift it left into the clip window.
        margin-left: -8px on the container to close the visual seam with standalone J.
      -->
      <div class="rest-clip" class:in={phase === 'sliding' || phase === 'out'}>
        <svg class="wm" viewBox="0 0 1841.43 520.1" xmlns="http://www.w3.org/2000/svg">
          <g fill="#fff">
            <path d="M274.14,86.67c19.36-20.08,31.34-20,42.25-25.76,20.29-10.74,21.9-26.75,21.9-26.75s1.72-15.25-11.18-21.8c-18.95-9.62-34,18.54-34,18.54s3.77-16.74-7.66-25.59-21.49-4-21.49-4-15.71,7.31-14,30.2C250.9,43.63,265.69,69.83,274.14,86.67Z"/>
            <path d="M665.35,86.67c19.36-20.08,31.33-20,42.25-25.76,20.29-10.74,21.89-26.75,21.89-26.75s1.73-15.25-11.17-21.8c-19-9.62-34,18.54-34,18.54s3.77-16.74-7.66-25.59-21.5-4-21.5-4-15.7,7.31-14,30.2C642.11,43.63,656.9,69.83,665.35,86.67Z"/>
            <path d="M911.66,119.65H911a27.72,27.72,0,0,0-26.58,21.65,153.76,153.76,0,0,1-5.73,18.4C861.85,204,832,252,805.22,282.66,789,301.49,774.1,314.18,763.7,314.18c-13.68,0-17.75-11.76-7.3-39.07l41.77-108.84c12.59-33,11.22-46.62-25.06-46.62h-.51A27.55,27.55,0,0,0,746,141.27a171.48,171.48,0,0,1-7.27,23.14l-30.16,78.2c-5,13.08-8.69,23.71-11.61,33.45-33.18,21.81-81.51,39.56-81.51,39.56l56.91-149.35c12.6-33,11.24-46.64-25-46.64h-.52a27.57,27.57,0,0,0-26.59,21.61,169.68,169.68,0,0,1-7.29,23.15L570.43,276.8c-17.35,23.29-40.23,37.38-55.49,37.38-17,0-22.16-13.18-11.52-41.42l40.79-106.49c12.6-33,11.28-46.62-25-46.62h-.52c-12.87.06-23.75,9.24-26.72,21.76a155.69,155.69,0,0,1-5.71,18.29c-15.88,41.92-46.77,92.32-73.49,123-16.23,18.83-31.13,31.52-41.53,31.52-13.68,0-17.65-12.2-7.3-39.07l41.77-108.84c12.6-33,11.23-46.62-25-46.62h-.52a27.56,27.56,0,0,0-26.58,21.62,168.62,168.62,0,0,1-7.27,23.14l-30.15,78.2c-5.2,13.54-8.95,24.44-11.91,34.46-33.12,21.35-80,38.55-80,38.55l56.9-149.35c12.6-33,11.24-46.64-25-46.64h-.52A27.58,27.58,0,0,0,229,141.24a169.68,169.68,0,0,1-7.29,23.15l-68.06,180c-42.14,18.85-69.61,33-97.44,53.24-27.25,19.79-49.1,45.23-55,73-6.15,29.22,10.31,49.47,42.35,49.47,69.73,0,126.35-60.78,167.75-170.08l2.13-5.65c30.68-13.66,63.83-30.15,84.05-43.35l.75-.5a.09.09,0,0,1,0,.05c-6.86,32.5,8.24,54.66,39.81,54.66,25.94,0,49.42-13.24,74.87-40.05a299,299,0,0,0,28.58-34.86c-1.86,6.57-3,11.76-3.87,16-7.95,37.7,10.19,58.93,42.75,58.93,27.69,0,54.51-16.45,73.56-35l-9.11,24.11c-42.14,18.85-69.61,33-97.44,53.24-27.25,19.79-49.1,45.23-55,73-6.15,29.22,10.31,49.47,42.35,49.47,69.73,0,126.35-60.78,167.75-170.08l2.13-5.65c30.68-13.66,63.83-30.15,84-43.35.79-.5,1.49-1,2.23-1.47-.08.34-.16.68-.23,1-6.86,32.5,8.23,54.66,39.81,54.66,25.93,0,49.42-13.24,74.86-40.05A298,298,0,0,0,834,280.31c-2,7.06-3.28,13.19-4.56,19.31-7.64,36.24,11.38,55.6,35.89,55.6,30.59,0,57.31-21.72,63.2-40.54,2.69-8.49.49-13.68-6.08-13.68,0,0-7,13.18-20.69,13.18-12.26,0-17.7-9.85-4.9-43.78l39.8-104.13C949.26,133.28,947.94,119.65,911.66,119.65ZM45.46,489c-14.6,0-19.79-8.95-17.21-21.2,3.48-16.48,16.27-32.5,38.42-50.4,17-13.67,41.09-27.33,75.56-43.35C112.69,449.42,78.91,489,45.46,489Zm391.21,0c-14.61,0-19.79-8.95-17.21-21.2,3.48-16.48,16.27-32.5,38.42-50.4,17-13.67,41.09-27.33,75.56-43.35C503.9,449.42,470.12,489,436.67,489Z"/>
            <path d="M1008,297.71c-17.89,0-36.08,14.61-40.15,33.93-3.48,16.47,5.39,28.29,22.3,28.29,20.74,0,37.31-16,40.8-32.51C1034.47,310.46,1025.84,297.71,1008,297.71Z"/>
            <path d="M1834.19,166.27c12.65-33,11.28-46.62-25-46.62h-.63A27.73,27.73,0,0,0,1782,141.3a152.48,152.48,0,0,1-5.73,18.4c-16.86,44.27-46.77,92.32-73.49,123-16.23,18.83-31.13,31.52-41.52,31.52-13.63,0-17.75-11.76-7.31-39.07l41.77-108.84c12.6-33,11.23-46.62-25-46.62h-.52a27.54,27.54,0,0,0-26.57,21.62,170.32,170.32,0,0,1-7.28,23.14L1619,209.32c-10.59,9.61-32.21,26.33-57.85,30a228.86,228.86,0,0,0,8.62-29.71c11.28-53.68-12.64-90-67.75-90-80.55,0-143.21,60.3-161.15,145.56a114.5,114.5,0,0,0-2.21,14.46c-32.7,20.1-75.79,35.94-75.79,35.94l56.87-149.34c12.6-33,11.28-46.62-25-46.62h-.52a27.29,27.29,0,0,0-26.35,21.4,156.42,156.42,0,0,1-7.55,23.36c-19.37,47.06-47.21,90-71.53,118.25-16.23,18.83-31.18,31.52-41.53,31.52-13.67,0-17.79-11.76-7.3-39.07l41.77-108.84c12.6-33,11.23-46.62-25-46.62h-.75a27.32,27.32,0,0,0-26.34,21.41,169.35,169.35,0,0,1-7.33,23.35l-30.1,78.2c-9.41,24.51-14.22,40.49-17.9,57.95-6.81,32.5,8.29,54.66,39.86,54.66,25.89,0,49.42-13.24,74.87-40.05a393.8,393.8,0,0,0,26-31.58l-22.7,60.75c-42.16,18.87-69.62,33-97.46,53.24-27.26,19.81-49.08,45.25-55,73.05-6.13,29.22,10.34,49.47,42.36,49.47,69.71,0,126.34-60.8,167.76-170.08l2.11-5.68c30.69-13.63,63.84-30.16,84-43.34l2.55-1.67c3.88,36.53,30.79,55.89,69.91,55.89,64.08,0,115.46-38.19,143.31-94.23,20.74-2.55,40.5-11,55.25-20.93l-1,2.55c-9.41,24.51-14.17,40.49-17.84,57.95-6.87,32.5,8.28,54.66,39.81,54.66,25.93,0,49.46-13.24,74.86-40.05a293,293,0,0,0,28.58-34.86c-2,7.06-3.29,13.19-4.56,19.31-7.65,36.24,11.38,55.6,35.89,55.6,30.64,0,57.31-21.72,63.19-40.54,2.7-8.49.5-13.68-6.08-13.68,0,0-7,13.18-20.68,13.18-12.26,0-17.7-9.85-4.91-43.78ZM1084,489c-14.61,0-19.81-9-17.21-21.22,3.43-16.48,16.23-32.51,38.39-50.4,17-13.68,41.08-27.31,75.55-43.34C1151.25,449.4,1117.47,489,1084,489ZM1418.2,331.64c-19.76,0-27.6-16.47-21.32-46.18,2.45-11.77,9.51-36.28,14.46-48.49,27.94-70.21,57.51-94.23,81.09-94.23,14.66,0,22.75,9,23.43,25.84-.1,2.69-.29,6.22-.68,10.44a192.18,192.18,0,0,1-20.5,69.23C1470.51,304.77,1443.65,331.64,1418.2,331.64Z"/>
          </g>
        </svg>
      </div>

    </div>
  </div>
{/if}

<style>
  .overlay {
    position: fixed;
    inset: 0;
    z-index: 99999;
    background: var(--loader, #000);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.9s ease;
  }
  .overlay.out { opacity: 0; pointer-events: none; }

  .logo {
    display: flex;
    align-items: flex-end; /* baseline-align on descenders */
  }

  /* standalone J: 140px tall, 91px wide */
  .j { height: 140px; width: 91px; display: block; flex-shrink: 0; }

  .sp {
    fill: transparent;
    stroke-dasharray: var(--len);
    stroke-dashoffset: var(--len);
    animation: draw var(--dur) cubic-bezier(0.4, 0, 0.2, 1) forwards var(--delay);
    transition: fill 0.5s ease 0.05s;
  }
  .sp.filled { fill: #fff; }
  @keyframes draw { to { stroke-dashoffset: 0; } }

  .rest-clip {
    overflow: hidden;
    height: 140px;
    width: 0;
    margin-left: -8px;
    opacity: 0;
    transform: translateX(20px);
    transition:
      width 0.9s cubic-bezier(0.22, 1, 0.36, 1),
      opacity 0.5s ease,
      transform 0.9s cubic-bezier(0.22, 1, 0.36, 1);
  }
  .rest-clip.in {
    width: 415px;
    opacity: 1;
    transform: translateX(0);
  }

  .wm {
    height: 140px;
    width: 495px;
    display: block;
    flex-shrink: 0;
    margin-left: -80px;
  }
</style>