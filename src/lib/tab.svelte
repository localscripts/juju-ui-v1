<script>
  let { 
    tab, 
    selected = false, 
    editing = false, 
    editVal = $bindable(''),
    onselect = () => {}, 
    onclose = () => {}, 
    onedit = () => {},
    onrename = () => {}
  } = $props();
  
  let renameInp;

  $effect(() => {
    if (editing) {
      setTimeout(() => {
        renameInp?.focus();
        renameInp?.select();
      }, 0);
    }
  });
</script>

<button
  onclick={onselect}
  class="p-2 font-medium min-w-42.5 px-2.5 justify-between flex items-center gap-2 rounded-md flex-shrink-0"
  style="
    background: {selected ? 'var(--tab-bg-selected)' : 'var(--tab-bg-unselected)'};
    color: {selected ? 'var(--tab-text-selected)' : 'var(--tab-text-unselected)'};
  "
  onmouseenter={(e) => { if (!selected) e.currentTarget.style.background = 'var(--tab-hover)'; }}
  onmouseleave={(e) => { if (!selected) e.currentTarget.style.background = 'var(--tab-bg)'; }}
>
  <div class="flex items-center gap-3.75 max-w-32">
    <svg class="size-3.75 flex-shrink-0" viewBox="0 0 14 14" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M0 0.75C0 0.551088 0.0790176 0.360322 0.21967 0.21967C0.360322 0.0790176 0.551088 0 0.75 0H13.25C13.4489 2.96403e-09 13.6397 0.0790176 13.7803 0.21967C13.921 0.360322 14 0.551088 14 0.75C14 0.948912 13.921 1.13968 13.7803 1.28033C13.6397 1.42098 13.4489 1.5 13.25 1.5H0.75C0.551088 1.5 0.360322 1.42098 0.21967 1.28033C0.0790176 1.13968 0 0.948912 0 0.75ZM0.75 3C0.551088 3 0.360322 3.07902 0.21967 3.21967C0.0790176 3.36032 0 3.55109 0 3.75C0 3.94891 0.0790176 4.13968 0.21967 4.28033C0.360322 4.42098 0.551088 4.5 0.75 4.5H10.75C10.9489 4.5 11.1397 4.42098 11.2803 4.28033C11.421 4.13968 11.5 3.94891 11.5 3.75C11.5 3.55109 11.421 3.36032 11.2803 3.21967C11.1397 3.07902 10.9489 3 10.75 3H0.75ZM0 6.75C0 6.55109 0.0790176 6.36032 0.21967 6.21967C0.360322 6.07902 0.551088 6 0.75 6H7.75C7.94891 6 8.13968 6.07902 8.28033 6.21967C8.42098 6.36032 8.5 6.55109 8.5 6.75C8.5 6.94891 8.42098 7.13968 8.28033 7.28033C8.13968 7.42098 7.94891 7.5 7.75 7.5H0.75C0.551088 7.5 0.360322 7.42098 0.21967 7.28033C0.0790176 7.13968 0 6.94891 0 6.75ZM0 9.75C0 9.55109 0.0790176 9.36032 0.21967 9.21967C0.360322 9.07902 0.551088 9 0.75 9H10.75C10.9489 9 11.1397 9.07902 11.2803 9.21967C11.421 9.36032 11.5 9.55109 11.5 9.75C11.5 9.94891 11.421 10.1397 11.2803 10.2803C11.1397 10.421 10.9489 10.5 10.75 10.5H0.75C0.551088 10.5 0.360322 10.421 0.21967 10.2803C0.0790176 10.1397 0 9.94891 0 9.75ZM0.75 12C0.551088 12 0.360322 12.079 0.21967 12.2197C0.0790176 12.3603 0 12.5511 0 12.75C0 12.9489 0.0790176 13.1397 0.21967 13.2803C0.360322 13.421 0.551088 13.5 0.75 13.5H13.25C13.4489 13.5 13.6397 13.421 13.7803 13.2803C13.921 13.1397 14 12.9489 14 12.75C14 12.5511 13.921 12.3603 13.7803 12.2197C13.6397 12.079 13.4489 12 13.25 12H0.75Z" fill={selected ? 'var(--tab-icon-selected)' : 'var(--tab-icon)'}/>
    </svg>
    {#if editing}
      <input
        bind:this={renameInp}
        type="text"
        bind:value={editVal}
        onblur={() => { if (editVal.trim()) onrename(editVal); else onedit(false); }}
        onkeydown={(e) => {
          if (e.key === 'Enter') { if (editVal.trim()) onrename(editVal); else onedit(false); }
          if (e.key === 'Escape') onedit(false);
        }}
        onclick={(e) => e.stopPropagation()}
        class="bg-transparent outline-none border-none text-inherit w-full"
      />
    {:else}
      <span ondblclick={() => onedit(true)} class="truncate">{tab.name}</span>
    {/if}
  </div>

  {#if selected}
    <button onclick={onclose}>
      <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.316867 0.330729C0.519817 0.127635 0.795041 0.0135436 1.08201 0.0135436C1.36899 0.0135436 1.64421 0.127635 1.84716 0.330729L6.49323 4.98148L11.1393 0.330729C11.2391 0.22726 11.3586 0.144729 11.4906 0.0879524C11.6226 0.031176 11.7647 0.00129087 11.9084 4.09035e-05C12.0521 -0.00120906 12.1946 0.0262009 12.3276 0.0806718C12.4606 0.135143 12.5814 0.215584 12.683 0.317301C12.7846 0.419018 12.865 0.539974 12.9194 0.673112C12.9738 0.80625 13.0012 0.948903 13 1.09275C12.9987 1.23659 12.9689 1.37875 12.9121 1.51092C12.8554 1.64309 12.773 1.76263 12.6696 1.86256L8.02353 6.51331L12.6696 11.1641C12.8667 11.3684 12.9758 11.642 12.9734 11.9261C12.9709 12.2101 12.8571 12.4818 12.6564 12.6827C12.4558 12.8836 12.1843 12.9975 11.9006 13C11.6168 13.0024 11.3434 12.8932 11.1393 12.6959L6.49323 8.04515L1.84716 12.6959C1.64305 12.8932 1.36967 13.0024 1.08591 13C0.802147 12.9975 0.530707 12.8836 0.33005 12.6827C0.129393 12.4818 0.0155741 12.2101 0.0131083 11.9261C0.0106425 11.642 0.119727 11.3684 0.316867 11.1641L4.96294 6.51331L0.316867 1.86256C0.113977 1.65941 0 1.38391 0 1.09665C0 0.809384 0.113977 0.533884 0.316867 0.330729Z" fill="var(--tab-remove-icon)"/>
      </svg>
    </button>
  {/if}
</button>